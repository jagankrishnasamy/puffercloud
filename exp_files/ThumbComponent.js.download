(function () {
  /*
  var loader = window.jacksmod.loader;
  loader.loadScript('common/component/WaitingComponent.js');
  loader.loadScript('common/component/GraphComponent.js');
  loader.loadScript('common/component/MapComponent.js');
  loader.loadScript('common/component/FailedComponent.js');
*/
})();

(function () {
  'use strict';
  var common = window.jacksmod.common;

  var ThumbComponent = common.ComponentQuery.extend({

    initialize: function (options) {
      this.children.waiting = new common.component.WaitingComponent();
      this.children.graph = new common.component.GraphComponent();
      this.children.failed = new common.component.FailedComponent();
      this.children.map = new common.component.MapComponent();
      this.children.map.on('switch-to-graph', this.switchToGraph.bind(this));
      this.children.graph.on('switch-to-map', this.switchToMap.bind(this));
      this.showGraph = true;
      this.lastState = null;
    },

    render: function () {
      if (! this.rendered)
      {
	this.$el = $('<div class="jacksmod"/>');
	this.$el.append(this.children.waiting.render());
	this.$el.append(this.children.graph.render());
	this.$el.append(this.children.failed.render());
	this.$el.append(this.children.map.render());
      }
      return this.superRender();
    },

    /* state.processing: true if we are still waiting for the graph
       state.graph: Graph object if graph is available */
    update: function (state) {
      if (state)
      {
	this.lastState = state;
	this.children.waiting.update({ shown: state.processing });
	this.children.failed.update({ shown: state.failed });
	this.children.map.update({
	  shown: ! this.showGraph && ! state.processing && ! state.failed,
	  graph: state.graph
	});
	this.children.graph.update({
	  shown: this.showGraph && ! state.processing && ! state.failed,
	  graph: state.graph
	});
      }
      this.superUpdate(state);
    },

    updateForce: function () {
      this.children.graph.updateForce({
      });
    },

    switchToGraph: function () {
      this.showGraph = true;
      this.update(this.lastState);
    },

    switchToMap: function () {
      this.showGraph = false;
      this.update(this.lastState);
    },
    
  });

  console.log('set ThumbComponent');
  window.jacksmod.thumb.ThumbComponent = ThumbComponent;
})();
